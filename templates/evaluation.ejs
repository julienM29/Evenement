<%- include('./shared/header.ejs', {title: 'Bienvenue sur mon blog' })%>

    <div class="min-vh-100 w-100 d-flex justify-content-center" style="background-color: rgb(242, 243, 243); margin-left: 14%;">
        <% if(evenement.statut_id !== 2){%>
            <div class="w-100 align-items-center d-flex justify-content-center  fs-4 spacingContentNavBarre"> Vous ne pouvez pas évaluer l'évènement "<b> <%= evenement.titre %></b>" car il n'est pas terminé.</div>
            <%  }%>
        <% if(evenement.statut_id === 2){%>
        <div class=" d-flex flex-column spacingContentNavBarre" style="width : 45%;">
            <div class="d-flex mb-2" style="height:440px">
                <div class=" h-100 d-flex flex-column mr-1" style="width : 30%;">
                    <div
                        class="h-50 bg-white rounded border mr-1 mb-1 d-flex justify-content-center align-items-center">
                        <div class="w-75">
                            <div class="w-100 text-center mb-2 h-25 d-flex justify-content-around ">
                                <img src="/images/organisateur.png" width="45" height="45">
                                <div class="fw-bold fs-4 d-flex align-items-center">Organisateur</div>
                            </div>
                            <div
                                class="text-center h-75 d-flex align-items-center justify-content-center fst-italic fs-5">
                                <%= evenement.organisateurNom %>
                                    <%= evenement.organisateurPrenom %>
                            </div>
                        </div>
                    </div>
                    <div
                        class="h-50 bg-white rounded border mr-1 d-flex align-items-center justify-content-center fs-5 flex-column">
                        <div class="fw-bold">Nombre de participants : </div>
                        <div
                            class=" text-decoration-none  mb-2 px-3 py-2    fs-3 fw-bold text-dark d-flex align-items-center">
                            <%= evenement.nbParticipants %>
                        </div>
                    </div>
                </div>
                <div class="position-relative " style="width:70%; height:100%;">

                    <img src="/images/<%= evenement.photo %>" class="w-100 h-100 rounded border mx-1 custom-shadow">
                    <div class="overlay border p-2 border-white">Changer la photo de l'évènement
                    </div>
                </div>
            </div>
            <div class="mb-2 w-100 bg-white rounded border px-2 py-3 fw-bold fs-5">
                <%= evenement.titre %>
            </div>
            <div class="mb-2 w-100 bg-white rounded border px-2 py-3 fs-5">
                <%= evenement.nom_ville %>
            </div>
            <div class="mb-2 w-100 bg-white rounded border px-2 py-3 d-flex flex-column ">
                <label class="border-b mb-2 fw-bold fs-5" for="description">Description de
                    l'évènement</label>
                <div class="p-3 rounded border fs-6">
                    <%= evenement.description %>
                </div>
            </div>

            <div class="d-flex justify-content-center mb-2 w-100 bg-white rounded border px-2 py-3">
                <div class="w-50 ">

                    <div class="mb-2 px-1 fs-5 fw-bold">
                        Début de l'évènement :
                    </div>
                    <div class="w-75 mx-1 p-1  d-flex justify-content-between  border" id="dateDebutDiv">
                        <div class="w-25 d-flex justify-content-center align-items-center fs-1 fw-bold "
                            id="debutEvenementJour">
                            <%= evenement.date_debut_evenement.jour %>
                        </div>
                        <div class="w-50 d-flex flex-column justify-content-center ">
                            <div class="fw-bold" id="debutEvenementMois">
                                <%= evenement.date_debut_evenement.moisNom %>
                                    <%= evenement.date_final_inscription.annee %>
                            </div>
                            <div id="debutEvenementHeure">
                                <%= evenement.date_debut_evenement.heures %>:<%= evenement.date_debut_evenement.minutes
                                        %>
                            </div>
                        </div>
                        <div class="w-25 d-flex  justify-content-center align-items-center">
                        </div>
                    </div>
                </div>
                <div class="w-50">

                    <div class="mb-2 px-1 fs-5 fw-bold">
                        Fin de l'évènement :
                    </div>
                    <div class="w-75 mx-1 p-1  d-flex justify-content-between   border" id="dateFinalDiv">

                        <div class="w-25 d-flex justify-content-center align-items-center fs-1 fw-bold "
                            id="finEvenementJour">
                            <%= evenement.date_fin_evenement.jour %>
                        </div>
                        <div class="w-50 d-flex flex-column justify-content-center ">
                            <div class="fw-bold" id="finEvenementMois">
                                <%= evenement.date_fin_evenement.moisNom %>
                                    <%= evenement.date_final_inscription.annee %>
                            </div>
                            <div id="finEvenementHeure">
                                <%= evenement.date_fin_evenement.heures %>:<%= evenement.date_fin_evenement.minutes %>
                            </div>

                        </div>
                        <div class="w-25 d-flex  justify-content-center align-items-center">
                        </div>
                    </div>
                </div>
            </div>
            <% }%>
            <% if(evenement.statut_id === 2){%>

            <div class="mb-2 w-100 bg-white rounded border d-flex flex-column align-items-center px-2 py-3 fs-5">
                <div class="mb-4 fw-bold fs-4">Évaluer l'évènement</div>
                <form action="" method="post" class="w-100 d-flex justify-content-center">
                    <div class="w-75 d-flex flex-column">
                        <!-- Section d'étoiles -->
                        <div class="d-flex  justify-content-between align-items-end mb-3" style="width:40%">
                            <div class="fw-bold"> Note : </div>
                            <div class="d-flex">
                                <% for(let i=1; i <=5; i++) { %>
                                    <div>
                                        <!-- Remplacez l'URL de l'image selon la note sélectionnée -->
                                        <img src="/images/etoile-blanche.png" alt="Étoile <%= i %>" id="Etoile<%=i%>" width="40"
                                            height="40" data-rating="<%= i %>" class="star" style="cursor: pointer;">
                                    </div>
                                    <% } %>
                            </div>
                        </div>

                        <!-- Champ de sélection de note -->
                         <% if (evaluation !== null) { %>
                            <input type="number" name="evaluation" id="rating" class="d-none" value="<%= evaluation.evaluation %>">
                            <% } else {%>
                                <input type="number" name="evaluation" id="rating" class="d-none" value="1">
                                <% } %>
                        

                        <!-- Champ de commentaire -->
                        <div class="mt-2 mb-2">
                            <label for="commentaire" class="fw-bold mb-2">Commentaire :</label>
                            <% if (evaluation !== null) { %>
                                <textarea name="commentaire" id="commentaire" class="form-control" rows="3"
                                    required><%= evaluation.commentaire %></textarea>
                                <% } else {%>
                                    <textarea name="commentaire" id="commentaire" class="form-control" rows="3"
                                        required></textarea>
                                    <% } %>
                        </div>

                        <div class="mt-2 mb-2 w-100 d-flex justify-content-center align-items-center">
                           <% if(evaluation !== null){ %>
                            <button type="submit" class="w-50 mt-3 btn btn-primary">Modifier votre évaluation</button>
                            <% } else {%>
                                <button type="submit" class=" mt-3 btn btn-primary">Envoyer</button>
                                <% } %>
                        </div>
                        <!-- Bouton de soumission -->
                        
                    </div>
                </form>
            </div>
        
            <% } %>
        </div>
        <% if (evaluationLength > 0) { %>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    let etoile = parseInt(document.getElementById('rating').value, 10); // Assurez-vous que etoile est un nombre entier
        
                    // Mettez à jour les étoiles en fonction de la note
                    for (let j = 1; j <= 5; j++) {
                        const star = document.getElementById(`Etoile${j}`);
                        if (j <= etoile) {
                            star.src = '/images/etoile.png'; // Étoile pleine
                        } else {
                            star.src = '/images/etoile-blanche.png'; // Étoile vide
                        }
                    }
                });
            </script>
        <% } %>
        
        <script>
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function () {
                    // Met à jour le champ de note caché avec la note sélectionnée
                    document.getElementById('rating').value = this.dataset.rating;

                    // Met à jour l'affichage des étoiles (facultatif)
                    document.querySelectorAll('.star').forEach(s => {
                        s.src = s.dataset.rating <= this.dataset.rating ? '/images/etoile.png' : '/images/etoile-blanche.png';
                    });
                });
            });
        </script>
        <%- include('./shared/footer.ejs')%>